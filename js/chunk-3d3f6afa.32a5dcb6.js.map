{"version":3,"sources":["webpack:///./src/views/login/index.vue?c3e6","webpack:///src/views/login/index.vue","webpack:///./src/views/login/index.vue?a2f2","webpack:///./src/views/login/index.vue","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./src/api/user.js","webpack:///./src/views/login/index.vue?6806"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","onLogin","onFailed","formRules","mobile","model","value","user","callback","$$v","$set","expression","code","scopedSlots","_u","key","fn","isCountDownShow","_e","isSendSmsLoading","preventDefault","onSendSms","apply","arguments","_v","proxy","staticRenderFns","name","data","methods","err","errors","error","message","position","component","DESCRIPTORS","FUNCTION_NAME_EXISTS","EXISTS","uncurryThis","defineProperty","f","FunctionPrototype","Function","prototype","functionToString","toString","nameRE","regExpExec","exec","NAME","configurable","get","login","request","method","url","sendSms","getCurrentUser","getUserProfile","updateUserProfile","updateUserPhoto","getUserChannels","addFollow","target","cancelFollow"],"mappings":"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","file":"js/chunk-3d3f6afa.32a5dcb6.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"login-container\"},[_c('van-nav-bar',{staticClass:\"app-nav-bar\",attrs:{\"title\":\"注册 / 登录\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-form',{ref:\"loginForm\",attrs:{\"show-error\":false,\"show-error-message\":false,\"validate-first\":\"\"},on:{\"submit\":function($event){return _vm.onLogin()},\"failed\":_vm.onFailed}},[_c('van-field',{attrs:{\"placeholder\":\"请输入手机号\",\"icon-prefix\":\"toutiao\",\"left-icon\":\"shouji\",\"name\":\"mobile\",\"rules\":_vm.formRules.mobile},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}}),_c('van-field',{attrs:{\"placeholder\":\"请输入验证码\",\"icon-prefix\":\"toutiao\",\"left-icon\":\"yanzhengma\",\"name\":\"code\",\"rules\":_vm.formRules.code},scopedSlots:_vm._u([{key:\"button\",fn:function(){return [(_vm.isCountDownShow)?_c('van-count-down',{staticClass:\"countdown\",attrs:{\"time\":1000*60,\"format\":\"ss 秒\"},on:{\"finish\":function($event){_vm.isCountDownShow=false}}}):_vm._e(),(!_vm.isCountDownShow)?_c('van-button',{ref:\"codeBtn\",staticClass:\"code-btn\",attrs:{\"size\":\"small\",\"round\":\"\",\"loading\":_vm.isSendSmsLoading,\"loading-text\":\"发送中...\"},on:{\"click\":function($event){$event.preventDefault();return _vm.onSendSms.apply(null, arguments)}}},[_vm._v(\" 获取验证码 \")]):_vm._e()]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}}),_c('div',{staticClass:\"login-btn-wrap\"},[_c('van-button',{staticClass:\"login-btn\",attrs:{\"type\":\"info\",\"block\":\"\"}},[_vm._v(\" 登录 \")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"login-container\">\n    <!--    导航栏-->\n    <van-nav-bar\n      class=\"app-nav-bar\"\n      title=\"注册 / 登录\"\n      left-arrow\n      @click-left=\"$router.back()\">\n    </van-nav-bar>\n    <!--    输入框-->\n    <!--    基于vant的表单验证：\n            1.使用van-form包裹表单项van-field\n            2.给van-form绑定submit事件，当表单提交时会触发submit事件\n              只有表单验证通过，才会调用submit事件\n              注意：表单中只要有按钮，点击按钮都会触发submit事件\n            3.使用Field的rules属性定义校验规则\n            validate-first为在第一项验证不通过就没必要继续验证下去了\n    -->\n    <van-form\n      :show-error=\"false\"\n      :show-error-message=\"false\"\n      validate-first\n      ref=\"loginForm\"\n      @submit=\"onLogin()\"\n      @failed=\"onFailed\"\n    >\n      <van-field\n        v-model=\"user.mobile\"\n        placeholder=\"请输入手机号\"\n        icon-prefix=\"toutiao\"\n        left-icon=\"shouji\"\n        name=\"mobile\"\n        :rules=\"formRules.mobile\"\n      ></van-field>\n      <van-field\n        v-model=\"user.code\"\n        placeholder=\"请输入验证码\"\n        icon-prefix=\"toutiao\"\n        left-icon=\"yanzhengma\"\n        name=\"code\"\n        :rules=\"formRules.code\"\n      >\n        <template #button>\n          <van-count-down\n            class=\"countdown\"\n            v-if=\"isCountDownShow\"\n            :time=\"1000*60\"\n            format=\"ss 秒\"\n            @finish=\"isCountDownShow=false\"/>\n          <van-button\n            class=\"code-btn\"\n            size=\"small\"\n            round\n            v-if=\"!isCountDownShow\"\n            :loading=\"isSendSmsLoading\"\n            loading-text=\"发送中...\"\n            ref=\"codeBtn\"\n            @click.prevent=\"onSendSms\"\n          >\n            获取验证码\n          </van-button>\n        </template>\n      </van-field>\n      <!--    登录按钮-->\n      <div class=\"login-btn-wrap\">\n        <van-button\n          class=\"login-btn\"\n          type=\"info\"\n          block\n        >\n          登录\n        </van-button>\n      </div>\n    </van-form>\n  </div>\n</template>\n\n<script>\nimport { login, sendSms } from '@/api/user'\nimport { Toast } from 'vant'\n\nexport default {\n  name: 'LoginIndex',\n  data () {\n    return {\n      user: {\n        mobile: '', // 手机号\n        code: '' // 验证码\n      },\n      // 验证规则\n      formRules: {\n        mobile: [\n          {\n            required: true, // 不能为空\n            message: '手机号不能为空'\n          },\n          {\n            pattern: /^1[3|5|7|8]\\d{9}$/, // 正则校验\n            message: '手机号格式错误'\n          }\n        ],\n        code: [\n          {\n            required: true,\n            message: '验证码不能为空'\n          },\n          {\n            pattern: /^\\d{6}$/,\n            message: '验证码格式错误'\n          }\n        ]\n      },\n      isCountDownShow: false, // 控制倒计时的显示\n      isSendSmsLoading: false // 控制发送验证码按钮的加载状态\n    }\n  },\n  methods: {\n    // 处理登录方法\n    async onLogin () {\n      Toast.loading({\n        message: '正在登录...',\n        forbidClick: true,\n        duration: 0 // 值为0，toast不会消失\n      })\n      // 处理异常\n      try {\n        const res = await login(this.user)\n        Toast.success('登录成功')\n        // 将后端返回的用户登录状态(token)放到Vuex容器中\n        this.$store.commit('setUser', res.data.data)\n        // 在组件渲染之前先清除Layout的缓存\n        this.$store.commit('removeCachePage', 'LayoutIndex')\n        // 登录成功，跳转回原来页面\n        this.$router.back()\n      } catch (err) {\n        console.log(err)\n        console.log('登录失败')\n        Toast.fail('登录失败，手机号或验证码错误')\n      }\n    },\n    // 表单验证失败时触发方法\n    onFailed (err) {\n      if (err.errors[0]) {\n        this.error = err.errors\n        Toast({\n          message: err.errors[0].message,\n          position: 'top'\n        })\n      }\n    },\n    // 点击验证码按钮触发的事件\n    async onSendSms () {\n      // 校验手机号，验证成功才发送验证码\n      // 取消默认的校验行为，通过click.prevent来实现（也就是取消事件冒泡）\n      // 手动触发校验：通过ref指定form获取到form表单，然后执行form的validate方法\n      // 传入field的name值，告知form表单校验这个field，返回的是Promise\n      try {\n        // await可以使用catch捕获异常\n        await this.$refs.loginForm.validate('mobile')\n        // 验证通过，发送验证码\n        this.isSendSmsLoading = true\n        await sendSms(this.user.mobile)\n        this.isCountDownShow = true\n        Toast.success({\n          message: '发送验证码成功，注意查看手机',\n          position: 'top'\n        })\n      } catch (err) {\n        // try中任何代码错误都会进入catch\n        // 不同的错误要有不同的提示\n        // 验证错误，提示错误\n        this.isCountDownShow = false\n        this.isSendSmsLoading = false\n        let message = ''\n        if (err.name === 'mobile') {\n          message = err.message\n        } else if (err.isAxiosError) {\n          message = '发送太频繁了，请稍后再试'\n        }\n        Toast({\n          message,\n          position: 'top'\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.countdown {\n  display: block;\n  height: 25px;\n  width: 100px;\n  line-height: 25px;\n  border-radius: 12px;\n  text-align: center;\n  font-size: 12px;\n  color: #666;\n  background: #ededed;\n}\n\n.code-btn {\n  width: 100px;\n  background: #ededed;\n  text-align: center;\n  color: #666;\n  font-size: 12px;\n}\n\n.login-btn-wrap {\n  padding: 26px 16px;\n\n  .login-btn {\n    background: #6db4fb;\n    border-radius: 15px;\n    border: none;\n    font-size: 16px;\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=86bea8be&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=86bea8be&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"86bea8be\",\n  null\n  \n)\n\nexport default component.exports","var DESCRIPTORS = require('../internals/descriptors');\nvar FUNCTION_NAME_EXISTS = require('../internals/function-name').EXISTS;\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar functionToString = uncurryThis(FunctionPrototype.toString);\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar regExpExec = uncurryThis(nameRE.exec);\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !FUNCTION_NAME_EXISTS) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return regExpExec(nameRE, functionToString(this))[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","// 用户相关的请求模块\nimport { request } from '@/utils/request'\n\n// 登录注册\nconst login = (user) => {\n  return request({\n    method: 'POST',\n    url: '/v1_0/authorizations',\n    data: user\n  })\n}\n// 发送短信验证码\nconst sendSms = mobile => {\n  return request({\n    method: 'GET',\n    url: `/v1_0/sms/codes/${mobile}`\n  })\n}\n// 获取用户个人信息\nconst getCurrentUser = () => {\n  return request({\n    method: 'GET',\n    url: '/v1_0/user'\n  })\n}\n// 获取用户资料\nconst getUserProfile = () => {\n  return request({\n    method: 'GET',\n    url: '/v1_0/user/profile'\n  })\n}\n// 编辑用户资料\nconst updateUserProfile = (data) => {\n  return request({\n    method: 'PATCH',\n    url: '/v1_0/user/profile',\n    data\n  })\n}\n// 修改用户头像\nconst updateUserPhoto = (data) => {\n  return request({\n    method: 'PATCH',\n    url: '/v1_0/user/photo',\n    data\n  })\n}\n// 获取用户频道列表\nconst getUserChannels = () => {\n  return request({\n    method: 'GET',\n    url: '/v1_0/user/channels'\n  })\n}\n// 关注用户\nconst addFollow = (target) => {\n  return request({\n    method: 'POST',\n    url: '/v1_0/user/followings',\n    data: {\n      target\n    }\n  })\n}\n// 取消关注用户\nconst cancelFollow = (target) => {\n  return request({\n    method: 'DELETE',\n    url: `/v1_0/user/followings/${target}`\n  })\n}\nexport {\n  login,\n  sendSms,\n  getCurrentUser,\n  getUserChannels,\n  addFollow,\n  cancelFollow,\n  getUserProfile,\n  updateUserProfile,\n  updateUserPhoto\n}\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=86bea8be&lang=less&scoped=true&\""],"sourceRoot":""}